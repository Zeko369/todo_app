# Migration `20200916162817-add-user`

This migration has been generated by Fran Zekan at 9/16/2020, 6:28:17 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."Role" AS ENUM ('USER', 'ADMIN')

ALTER TABLE "public"."List" ADD COLUMN "userId" integer   

ALTER TABLE "public"."Tag" ADD COLUMN "userId" integer   

ALTER TABLE "public"."Task" ADD COLUMN "userId" integer   

ALTER TABLE "public"."Todo" ADD COLUMN "userId" integer   

CREATE TABLE "public"."User" (
"id" SERIAL,
"username" text   NOT NULL ,
"email" text   NOT NULL ,
"password" text   NOT NULL ,
"role" "Role"  NOT NULL DEFAULT E'USER',
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "User.username_unique" ON "public"."User"("username")

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

ALTER TABLE "public"."List" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Tag" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Task" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Todo" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200912110235-add-pinned-to-todos..20200916162817-add-user
--- datamodel.dml
+++ datamodel.dml
@@ -3,11 +3,30 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
+enum Role {
+  USER
+  ADMIN
+}
+
+model User {
+  id        Int      @default(autoincrement()) @id
+  username  String   @unique
+  email     String   @unique
+  password  String
+  todos     Todo[]
+  tasks     Task[]
+  lists     List[]
+  tags      Tag[]
+  role      Role     @default(USER)
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
 model Todo {
   id          Int       @default(autoincrement()) @id
   pinned      Boolean   @default(false)
   title       String?
@@ -19,8 +38,10 @@
   listId      Int?
   requires    Todo[]    @relation("Requirements", references: [id])
   requiredBy  Todo[]    @relation("Requirements", references: [id])
   tags        Tag[]     @relation("Tags", references: [id])
+  user        User?     @relation(fields: [userId], references: [id])
+  userId      Int?
   createdAt   DateTime  @default(now())
   updatedAt   DateTime  @updatedAt
 }
@@ -31,8 +52,10 @@
   // parentTaskId Int?
   todo      Todo      @relation(fields: [todoId], references: [id])
   todoId    Int
   title     String
+  user      User?     @relation(fields: [userId], references: [id])
+  userId    Int?
   checkedAt DateTime?
   createdAt DateTime  @default(now())
   updatedAt DateTime  @updatedAt
 }
@@ -40,8 +63,10 @@
 model List {
   id         Int       @default(autoincrement()) @id
   title      String?
   todos      Todo[]
+  user       User?     @relation(fields: [userId], references: [id])
+  userId     Int?
   archivedAt DateTime?
   createdAt  DateTime  @default(now())
   updatedAt  DateTime  @updatedAt
 }
@@ -50,7 +75,9 @@
   id        Int      @default(autoincrement()) @id
   text      String
   color     String?
   todos     Todo[]   @relation("Tags", references: [id])
+  user      User?    @relation(fields: [userId], references: [id])
+  userId    Int?
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
 }
```


